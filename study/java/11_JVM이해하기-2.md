# 10. JVM ì´í•´í•˜ê¸° - 2 (ì •ë¦¬ì¤‘)
## Runtime Data Area (ëŸ°íƒ€ìž„ ë°ì´í„° ì˜ì—­)

í”„ë¡œê·¸ëž¨ ì‹¤í–‰ ì¤‘ì— ì‚¬ìš©ë˜ëŠ” ë©”ëª¨ë¦¬ ì˜ì—­ì„ ë§í•œë‹¤. ëŸ°íƒ€ìž„ ë°ì´í„° ì˜ì—­ ì¤‘ ì¼ë¶€ëŠ” JVM ì‹œìž‘ ì‹œ ìƒì„±ë˜ì–´ JVMì´ ì¢…ë£Œë  ë•Œë§Œ ì†Œë©¸ëœë‹¤. ê·¸ë¦¬ê³  ì´ì™¸ì˜ ì˜ì—­ì€ ìŠ¤ë ˆë“œë³„ë¡œ ê´€ë¦¬ëœë‹¤. ìŠ¤ë ˆë“œë³„ ë°ì´í„° ì˜ì—­ì€ ìŠ¤ë ˆë“œê°€ ìƒì„±ì£¼ê¸°ë¥¼ ë”°ë¥¸ë‹¤. ëŸ°íƒ€ìž„ ë°ì´í„° ì˜ì—­ì€ ë‹¤ìŒê³¼ ê°™ì´ ë‚˜ë‰˜ì–´ì ¸ ìžˆë‹¤.

> Run-time Data AreaëŠ” JVMì´ ì‹¤í–‰ ì¤‘ì— ì“°ëŠ” ë©”ëª¨ë¦¬ ì§€ë„ë¥¼ í‘œì¤€í™”í•œ ê²ƒ
>
- ìŠ¤ë ˆë“œ ê³µìœ (Shared)
  - Heap
  - ë©”ì„œë“œ ì˜ì—­(Method Area)
- ìŠ¤ë ˆë“œ ì „ìš©(Per-thread)
  - PC ë ˆì§€ìŠ¤í„°
  - JVM ìŠ¤íƒ
  - ë„¤ì´í‹°ë¸Œ ë©”ì„œë“œ ìŠ¤íƒ
    - ëŸ°íƒ€ìž„ ìƒìˆ˜ í’€

![img.png](../../image/java/java_11_02.png)

### PC Register (Thread ì „ìš©)

PC RegisterëŠ” ê° ìŠ¤ë ˆë“œê°€ **í˜„ìž¬ ì‹¤í–‰ ì¤‘ì¸ ë°”ì´íŠ¸ì½”ë“œì˜ ì£¼ì†Œë¥¼ ê°€ë¦¬í‚¤ëŠ” í¬ì¸í„° ì—­í• **ì„ í•œë‹¤. ìžë°” ë©”ì„œë“œê°€ ì‹¤í–‰ ì¤‘ì´ë©´ í˜„ìž¬ ëª…ë ¹ì–´ ìœ„ì¹˜ê°€ ë“¤ì–´ìžˆë‹¤. ë˜ëŠ” ë„¤ì´í‹°ë¸Œ ë©”ì„œë“œê°€ ì‹¤í–‰ ì¤‘ì´ë¼ë©´ ê°’ì´ Undefinedë¡œ ì·¨ê¸‰ëœë‹¤.

**ì €ìž¥ë˜ëŠ” ê°’**

- í˜„ìž¬ ì‹¤í–‰ ì¤‘ì¸ JVM ë°”ì´íŠ¸ì½”ë“œ ì£¼ì†Œ (instruction address)

**íŠ¹ì§•**

- ìŠ¤ë ˆë“œë§ˆë‹¤ í•˜ë‚˜ì”© ì¡´ìž¬
- ë„¤ì´í‹°ë¸Œ ë©”ì„œë“œ ì‹¤í–‰ ì‹œ undefined ìƒíƒœ
- ë§¤ìš° ìž‘ì€ ë©”ëª¨ë¦¬

PC Registerê°€ í•„ìš”í•œ ì´ìœ ëŠ” ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ë‹¤ë¥¸ ë°”ì´íŠ¸ì½”ë“œ ìœ„ì¹˜ë¥¼ ì‹¤í–‰í•˜ë‹ˆê¹Œ í˜„ìž¬ ìœ„ì¹˜ë¥¼ ìŠ¤ë ˆë“œë³„ë¡œ ë³´ê´€í•´ì•¼ Context Switching, ì˜ˆì™¸ ì²˜ë¦¬ì™€ ê°™ì€ ë™ìž‘ì„ í•  ìˆ˜ ìžˆë‹¤.

### JVM Stack (Thread ì „ìš©)

ìŠ¤ë ˆë“œë§ˆë‹¤ í•˜ë‚˜ì˜ ìŠ¤íƒì„ ê°€ì§€ê³  ìžˆê³ , ë©”ì†Œë“œ í˜¸ì¶œë§ˆë‹¤ Stack Frameì´ push/pop ëœë‹¤. JVM Stackì€ Cì–¸ì–´ì˜ ìŠ¤íƒê³¼ ìœ ì‚¬í•˜ë©°, ì§€ì—­ ë³€ìˆ˜ì™€ ë¶€ë¶„ ê²°ê³¼ë¥¼ ì €ìž¥í•˜ê³  ë©”ì†Œë“œ í˜¸ì¶œ ë° ë°˜í™˜ì— ê´€ì—¬í•œë‹¤.

**ì €ìž¥ë˜ëŠ” ê°’**

- ê° ë©”ì„œë“œ í˜¸ì¶œë§ˆë‹¤ Stack Frame ìƒì„±
  - Stack Frame ë‚´ë¶€ êµ¬ì„±
    - Local Variables
    - Operand Stack (ì—°ì‚°ìš© ìŠ¤íƒ)
    - Frame data (return address ë“±)

**íŠ¹ì§•**

- JVM ìŠ¤íƒì€ í”„ë ˆìž„ì„ í‘¸ì‹œí•˜ê³  íŒí•˜ëŠ” ìž‘ì—… ì™¸ì—ëŠ” ì§ì ‘ ì¡°ìž‘ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ í”„ë ˆìž„ì€ íž™ ì˜ì—­ì— í• ë‹¹ë  ìˆ˜ ìžˆë‹¤.
  â†’ í”„ë ˆìž„ì„ íž™ì— ê°ì²´ì²˜ëŸ¼ í• ë‹¹í•´ë‘ê³  í”„ë ˆìž„ ê°ì²´ë¥¼ ê°€ë¦¬í‚¤ëŠ” í¬ì¸í„°ë¥¼ ìŠ¤íƒì— ì €ìž¥í•  ìˆ˜ ìžˆë‹¤ëŠ” ì˜ë¯¸
  â†’ JVM ìŠ¤íƒ/í”„ë ˆìž„ì€ ì¶”ìƒ ê°œë…ì´ê³ , êµ¬í˜„ì€ ìžìœ ë‹¤.
- í”„ë¡œê·¸ëž˜ë¨¸ ë˜ëŠ” ì‚¬ìš©ìžê°€ JVM ìŠ¤íƒì˜ ì´ˆê¸° í¬ê¸°ë¥¼ ì œì–´í•  ìˆ˜ ìžˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ê³  ë˜í•œ ìµœëŒ€ ë° ìµœì†Œ í¬ê¸°ë¥¼ ì œì–´í•  ìˆ˜ ìžˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
- JVM ìŠ¤íƒ ì˜ˆì™¸
  - StackOverflowError
  - OutOfMemoryError
    - JVMì´ ìŠ¤íƒì„ ë™ì ìœ¼ë¡œ í™•ìž¥í–ˆì§€ë§Œ ë©”ëª¨ë¦¬ê°€ ë¶€ì¡±í•œ ê²½ìš°, ìƒˆ ìŠ¤ë ˆë“œì— ì´ˆê¸° ìŠ¤íƒì„ ìƒì„±í•˜ëŠ”ë° ë©”ëª¨ë¦¬ê°€ ë¶€ì¡±í•œ ê²½ìš° ì˜ˆì™¸ ë°œìƒ

### Native Method Stack (Thread ì „ìš©)

JNIë¡œ C/C++ ê°™ì€ ë„¤ì´íŠ¸ ì½”ë“œë¥¼ í˜¸ì¶œí•  ë•Œ ì“°ëŠ” ìŠ¤íƒ ì˜ì—­ì´ë‹¤.

**ì €ìž¥ë˜ëŠ” ê°’**

- C, C++ ë“± JNI ë„¤ì´í‹°ë¸Œ ë©”ì†Œë“œ ì‹¤í–‰ ì •ë³´

```java
System.currentTimeMillis(); // ë‚´ë¶€ëŠ” native
```

**íŠ¹ì§•**

- ìžë°” ìŠ¤íƒê³¼ ë³„ê°œë¡œ ê´€ë¦¬ ë  ìˆ˜ ìžˆë‹¤.
- ë„¤ì´í‹°ë¸Œ ìª½ì—ì„œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜/ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš°/í¬ëž˜ì‹œê°€ ë‚˜ë©´ JVMì´ ê°™ì´ ì£½ì„ ìˆ˜ ìžˆë‹¤.
- ë„¤ì´í‹°ë¸Œ ë©”ì„œë“œë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ê±°ë‚˜ ê¸°ì¡´ ìŠ¤íƒ(C ìŠ¤íƒ)ì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ” JVM êµ¬í˜„ì²´ëŠ” ë„¤ì´í‹°ë¸Œ ë©”ì„œë“œ ìŠ¤íƒì„ ì œê³µí•  í•„ìš”ê°€ ì—†ë‹¤.
- ë„¤ì´í‹°ë¸Œ ë©”ì„œë“œ ìŠ¤íƒ ì˜ˆì™¸
  - StackOverflowError
  - OutOfMemoryError

### Heap

íž™ì€ ê°€ìƒ ë¨¸ì‹  ì‹œìž‘ì‹œ ìƒì„±ë˜ê³ , ëª¨ë“  í´ëž˜ìŠ¤ **ì¸ìŠ¤í„´ìŠ¤**ì™€ **ë°°ì—´**ì— í•„ìš”í•œ ë©”ëª¨ë¦¬ê°€ í• ë‹¹ë˜ëŠ” ì˜ì—­ì´ë‹¤. ê°ì²´ì— í• ë‹¹ëœ íž™ ê³µê°„ì€ GCì— ì˜í•´ íšŒìˆ˜ë˜ë©°, ê°ì²´ëŠ” ëª…ì‹œì ìœ¼ë¡œ í• ë‹¹ í•´ì œë˜ì§€ ì•ŠëŠ”ë‹¤.

**ì €ìž¥ë˜ëŠ” ê°’**

- ëª¨ë“  ê°ì²´ ì¸ìŠ¤í„´ìŠ¤(Object)
- ë°°ì—´(primitive ë°°ì—´ í¬í•¨)

**íŠ¹ì§•**

- JVM ëª…ì„¸ëŠ” GC ì•Œê³ ë¦¬ì¦˜ì„ ê°•ì œí•˜ì§€ ì•ŠëŠ”ë‹¤. GCëŠ” JVM êµ¬í˜„ê³¼ ì‹¤í–‰ ì˜µì…˜ìœ¼ë¡œ ì„ íƒí•  ìˆ˜ ìžˆë‹¤.

  â†’ GC ìµœì í™” ì˜µì…˜ë“¤

- íž™ ì˜ˆì™¸
  - OutOfMemoryError
    - ê³„ì‚°ì— í•„ìš”í•œ íž™ í¬ê¸°ê°€ GCì—ì„œ ì œê³µí•˜ëŠ” ê²ƒë³´ë‹¤ í¬ë©´ JVMì€ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.

**Heapê³¼ ê´€ë ¨ëœ ëŒ€í‘œ ì´ìŠˆ**

- OutOfMemoryError
- GC pause(STW) : Throughput/Latency íŠ¸ë ˆì´ë“œ ì˜¤í”„
- ë©”ëª¨ë¦¬ ëˆ„ìˆ˜(ê°ì²´ê°€ ì°¸ì¡° ì—°ê²°ë˜ì–´ íšŒìˆ˜ ëª»í•¨)

### Method Area

ë©”ì†Œë“œ ì˜ì—­ì€ ê°€ìƒ ë¨¸ì‹  ì‹œìž‘ì‹œ ìƒì„±ëœë‹¤. ë…¼ë¦¬ì ìœ¼ë¡œ íž™ì˜ ì¼ë¶€ì´ì§€ë§Œ, ê°„ë‹¨í•œ êµ¬í˜„ì—ì„œëŠ” GCë‚˜ ì••ì¶•ì„ ìˆ˜í–‰ì„ í•˜ì§€ ì•Šì„ ìˆ˜ ìžˆë‹¤.

**ì €ìž¥ë˜ëŠ” ê°’**

- í´ëž˜ìŠ¤ êµ¬ì¡° ì •ë³´(í•„ë“œ/ë©”ì†Œë“œ ì •ë³´)
- ëŸ°íƒ€ìž„ ìƒìˆ˜ í’€
- static ë³€ìˆ˜
- ë©”ì†Œë“œ ë°”ì´íŠ¸ ì½”ë“œ

HotSpotì€ Java8ë¶€í„°ëŠ” PermGen ëŒ€ì‹  Metaspaceë¥¼ ì‚¬ìš©í•œë‹¤.

- í´ëž˜ìŠ¤ ë©”íƒ€ë°ì´í„°ê°€ ë„¤ì´í‹°ë¸Œ ë©”ëª¨ë¦¬ì— ì €ìž¥ëœë‹¤.
- í´ëž˜ìŠ¤ ë¡œë” ëˆ„ìˆ˜ëŠ” ëŒ€ê²Œ ë©”íƒ€ë°ì´í„°ê°€ ê³„ì† ë¶ˆì–´ë‚˜ëŠ” ê±¸ë¡œ ê´€ì¸¡ëœë‹¤.
- ì˜ˆì™¸
  - OutOfMemory : ë©”ì†Œë“œ ì˜ì—­ì˜ ë©”ëª¨ë¦¬ê°€ í• ë‹¹ ìš”ì²­ì„ ì¶©ì¡±í•  ë§Œí¼ í™•ë³´ë˜ì§€ ì•Šìœ¼ë©´ ë°œìƒ

### Run-Time Constant Pool

í´ëž˜ìŠ¤ íŒŒì¼ì˜ Constant Poolì´ ëŸ°íƒ€ìž„ì— ë¡œë“œ ë˜ë©´ ëŸ°íƒ€ìž„ ìƒìˆ˜ í’€ì´ ëœë‹¤.

- ë¦¬í„°ëŸ´(ë¬¸ìžì—´ ë“±)
- í´ëž˜ìŠ¤/ë©”ì†Œë“œ/í•„ë“œì˜ ì‹¬ë³¼ ì°¸ì¡°
- ë™ì  í˜¸ì¶œ ì •ë³´(invoke dynamic ê´€ë ¨)
- ë§í¬ ë‹¨ê³„ ì¤‘ â€œí•´ê²°â€ ë‹¨ê³„ ì—ì„œ ì‹¬ë³¼ ì°¸ì¡°ê°€ ì‹¤ì œ ì°¸ì¡°ë¡œ ì—°ê²°ë˜ëŠ” ê³¼ì •ì´ ì´ í’€ê³¼ ì—°ê´€ë˜ì–´ ìžˆë‹¤.

### OOM ë©”ì„¸ì§€

- OutOfMemoryError : Java Heap space â†’ Heap(ê°ì²´/ë°°ì—´) ë¶€ì¡±
- OutOfMemoryError : Metaspace â†’ Metaspace ë¶€ì¡± or í´ëž˜ìŠ¤ ë¡œë” ëˆ„ìˆ˜ ì˜ì‹¬
- OutOfMemoryError : Compressed class space â†’ Class space ë¶€ì¡± ê°€ëŠ¥
- Code Cache ë¶€ì¡±
  - JIT ì½”ë“œê°€ ìŒ“ì—¬ Code Cache pressure

### Heap ë©”ëª¨ë¦¬ êµ¬ì¡°

![image.png](/image/java/java_11_01.png)

Java Heapì—ëŠ” ë©”ëª¨ë¦¬ í•´ì œë¥¼ ìœ„í•œ ì–´ë–¤ Java Codeë‚˜ Bycodeë„ ì¡´ìž¬í•˜ì§€ ì•ŠëŠ”ë‹¤. Memoryë¥¼ í• ë‹¹í•˜ëŠ” Instructionë§Œ ì¡´ìž¬í•œë‹¤.

- Heap ì˜ì—­ì— ë©”ëª¨ë¦¬ í•´ì œëŠ” GCë¥¼ í†µí•´ì„œë§Œ ìˆ˜í–‰ëœë‹¤.
- JVM ìŠ¤íŽ™(Specification)ì€ ì´ëŸ¬í•œ ì›ì¹™ì„ ê°•í•˜ê²Œ ì œì‹œí•˜ê³ , êµ¬í˜„ì„ ë‹´ë‹¹í•œ JVM ë²¤ë”(Oracle, IBM)ë“±ì€ ìµœëŒ€í•œ ì´ë¥¼ ë”°ë¥¸ë‹¤.
- ê·¸ëŸ¬ë‚˜ ì´ê²ƒì€ ì›ì¹™ì¼ ë¿ ì–´ë–»ê²Œ êµ¬í˜„í•˜ëŠ” ì§€ì— ëŒ€í•´ì„œëŠ” ì „ì ìœ¼ë¡œ ë²¤ë”ë“¤ì—ê²Œ ì¼ìž„í•œë‹¤.

> Instruction
JVMì´ Heapì— ì‹¤ì œ ê°ì²´ ë©”ëª¨ë¦¬ë¥¼ í™•ë³µí•˜ë„ë¡ ì§€ì‹œí•˜ëŠ” ë°”ì´íŠ¸ ì½”ë“œ ëª…ë ¹ì–´
- **new, newarray, anewarray, nultianewarray**
>
- **Yong Generation**
  - Eden : Objectê°€ Heapì— ìµœì´ˆë¡œ í• ë‹¹ë˜ëŠ” ìž¥ì†Œ
  - Survivor S0/S1 : Eden ì˜ì—­ì—ì„œ ì‚´ì•„ë‚¨ì€ Objectë“¤ì´ ìž ì‹œ ë¨¸ë¬´ë¥´ëŠ” ê³³. ë‘ ì˜ì—­ìœ¼ë¡œ ë‚˜ë‰˜ì–´ì ¸ ìžˆê³ , ë‘ ì˜ì—­ ì¤‘ í•˜ë‚˜ì˜ Survivorë¡œ ì´ë™í•˜ê²Œ ëœë‹¤.
  - Minor GC : Edenì— ìƒˆë¡œìš´ ê°ì²´ê°€ í• ë‹¹ë˜ê³  ì–¼ë§ˆ ì§€ë‚˜ì§€ ì•Šì•„ Eden ì˜ì—­ì´ ê°€ë“ì°¨ê²Œ ë˜ë©´ Objectì˜ ì°¸ì¡° ì—¬ë¶€ë¥¼ í™•ì¸í•´ ì°¸ì¡°ê°€ ìœ ì§€ë˜ëŠ” Live Objectì´ë©´ Survivorì˜ì—­ìœ¼ë¡œ ë„˜ê¸°ê³ , ì°¸ì¡°ê°€ ëŠê¸´ GC ìˆ˜ì§‘ ëŒ€ìƒì´ë©´ ë‚¨ê²¨ ë‘”ë‹¤. ê·¸ë¦¬ê³  Live Objectê°€ Survivorë¡œ ëª¨ë‘ ë„˜ì–´ê°€ê²Œ ë˜ë©´, ë‚¨ì•„ìžˆëŠ” Object ëª¨ë‘ ì²­ì†Œ(Scavenge)í•œë‹¤. ì´ëŸ¬í•œ ê³¼ì •ì„ Minor GCë¼ê³  í•œë‹¤.
- **Old Generation (Tenured Generation)**
  - ì˜¤ëž˜ ì‚´ì•„ë‚¨ì€ ê°ì²´ê°€ Old ì˜ì—­ìœ¼ë¡œ ì´ë™ëœë‹¤. Old ì˜ì—­ì— ë“¤ì–´ì˜¨ ê°ì²´ë“¤ì€ ì˜¤ëž«ë™ì•ˆ ì°¸ë„ê°€ ë˜ì–´ ìžˆê³ , ì•žìœ¼ë¡œë„ ê³„ì† ì‚¬ìš©ë  í™•ë¥ ì´ ë†’ì€ Objectë“¤ì„ ì €ìž¥í•˜ëŠ” ì˜ì—­ì´ë‹¤.
    - ì˜¤ëž˜ ì‚´ì•„ë‚¨ì€ ê°ì²´ëž€ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ íŠ¹ì • íšŒìˆ˜ ì´ìƒ ì°¸ì¡°ë˜ì–´ ê¸°ì¤€ Ageë¥¼ ì´ˆê³¼í•œ Objectë¥¼ ë§í•œë‹¤.
  - Old ì˜ì—­ì˜ ë©”ëª¨ë¦¬ë„ ì¶©ë¶„í•˜ì§€ ì•Šìœ¼ë©´ GCê°€ ë°œìƒí•˜ëŠ”ë° ì´ë¥¼ Full GC(Major GC)ë¼ê³  í•œë‹¤.
- **Permanent**
  - Perm ì˜ì—­ì€ Classì˜ Meta ì •ë³´ë‚˜ Methodì˜ Meta ì •ë³´, Static ë³€ìˆ˜ì™€ ìƒìˆ˜ ì •ë³´ë“¤ì´ ì €ìž¥ë˜ëŠ” ê³µê°„ì´ë‹¤.
  - ì›ëž˜ëŠ” Heap ê³µê°„ì— ìžˆì—ˆëŠ”ë°, Java 8 ë¶€í„° Native ì˜ì—­ìœ¼ë¡œ ì´ë™í•˜ì—¬ Metaspace ì˜ì—­ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆë‹¤.
- **Minor GC**
  - ì£¼ë¡œ Young ì˜ì—­ ìˆ˜ì§‘
- **Major GC**
  - Old ì˜ì—­ ì¤‘ì‹¬ ìˆ˜ì§‘
- **Metaspace**
  - í´ëž˜ìŠ¤ ë©”íƒ€ë°ì´í„°(í´ëž˜ìŠ¤/ë©”ì†Œë“œ/í•„ë“œ êµ¬ì¡°, ìƒìˆ˜í’€ ë©”íƒ€ ë“±) ì €ìž¥
  - PermGen : Java 7ê¹Œì§€ ì¡´ìž¬. íž™ ë‚´ë¶€ ì˜ì—­ì— ìœ„ì¹˜í•´ì„œ íŠœë‹ì´ ê¹Œë‹¤ë¡œì› ìŒ
  - Heap ì™¸ë¶€ì˜ ì˜ì—­ì— ìœ„ì¹˜

### Metaspaceì™€ Permanent

Permê³¼ Metaspaceì˜ ë³€ê²½ ì‚¬í•­

![img_1.png](../../image/java/java_11_03.png)

| êµ¬ë¶„ | ìƒì„¸ êµ¬ë¶„ | ~ Java 7 | Java 8 |
| --- | --- | --- | --- |
| ì €ìž¥ ì •ë³´ | Class Meta ì •ë³´ | ì €ìž¥ | ì €ìž¥ |
|  | Method Meta ì •ë³´ | ì €ìž¥ | ì €ìž¥ |
|  | Static Object ë³€ìˆ˜, ìƒìˆ˜ | ì €ìž¥ | Heap ì˜ì—­ìœ¼ë¡œ ì´ë™ |
| ê´€ë¦¬ í¬ì¸íŠ¸ | ë©”ëª¨ë¦¬ ê´€ë¦¬ (íŠœë‹) | Heap ì˜ì—­ íŠœë‹ì™¸ì— Perm ì˜ì—­ ë³„ë„ íŠœë‹ | Heap ì˜ì—­ íŠœë‹, Native ì˜ì—­ ë™ì  ì¡°ì • |
| GC ì¸¡ë©´ | GC ìˆ˜í–‰ ëŒ€ìƒ | Full GC ìˆ˜í–‰ ëŒ€ìƒ | Full GC ìˆ˜í–‰ ëŒ€ìƒ |
| ë©”ëª¨ë¦¬ ì¸¡ë©´ | ë©”ëª¨ë¦¬ í¬ê¸°(ì˜µì…˜) | -XX:PermSize
-XX:MaxPermSize | -XX:MetassapceSize
-XX:MaxMetaspaceSize |
- Metaspace ì˜ì—­ì€ Native ë©”ëª¨ë¦¬ë¡œ ì·¨ê¸‰ë˜ê¸° ë•Œë¬¸ì— ê¸°ë³¸ì ìœ¼ë¡œ JVMì— ì˜í•´ í¬ê¸°ê°€ ê°•ì œë˜ì§€ ì•ŠëŠ”ë‹¤.
- ì˜µì…˜ì„ í†µí•´ ì œí•œì´ ê°€ëŠ¥í•˜ë‹¤.
- Metasapce ì˜ì—­ì€ í•„ìš”ì— ë”°ë¼ ìžë™ì ìœ¼ë¡œ ì¦ê°€í•œë‹¤.

## Garbage Collector

GCëŠ” ë©”ëª¨ë¦¬ ê³µê°„ì´ ë¶€ì¡±í•´ì§€ë©´ ìˆ˜í–‰í•˜ê²Œ ëœë‹¤. ìƒˆë¡œìš´ Objectì˜ í• ë‹¹ì„ í•´ì•¼ í•˜ëŠ”ë° Heap ê³µê°„ì´ ë¶€ë³µí•˜ë‹¤ë©´, í• ë‹¹ëœ Objectë“¤ ì¤‘ ë” ì´ìƒ ì°¸ì¡°ë˜ì§€ ì•Šì€ ê°ì²´ë“¤ì„ íšŒìˆ˜í•˜ê³  ê·¸ ê³µê°„ì„ ìž¬í™œìš©ë ¤ëŠ” ëª©ì ìœ¼ë¡œ ìˆ˜í–‰ë˜ëŠ” ê²ƒì´ë‹¤.

> ì°¸ì¡°ë˜ì§€ ì•Šì€ ê°ì²´ëž€?
>
- GC Root(ìŠ¤ë ˆë“œ ìŠ¤íƒ, static, JNI ë“±)ì—ì„œ ì‹œìž‘í•´ ì°¸ì¡° ê·¸ëž˜í”„ë¥¼ ë”°ë¼ê°€ë©° ë„ë‹¬ ê°€ëŠ¥í•œ ê°ì²´ë¥¼ ë§í•œë‹¤.
- ê·¸ëž˜ì„œ ì´ ê·¸ëž˜í”„ë¥¼ í†µí•´ ë„ë‹¬í•  ìˆ˜ ì—†ëŠ” ê°ì²´ë“¤ì€ íšŒìˆ˜ë¥¼ ì‹œìž‘í•œë‹¤.(unreachable)
- ì •ì±…/ëª©í‘œ : JVM êµ¬í˜„ì²´ì— ë”°ë¼ ë‹¤ë¥´ì§€ë§Œ ë³´íŽ¸ì ìœ¼ë¡œ ì²˜ë¦¬ëŸ‰, ì§€ì—°ì‹œê°„, íž™ ë‹¨íŽ¸í™”, ì„¸ëŒ€ë³„(Young, Old) ê·œì¹™ì„ ì ìš©

ì¦‰, GCëŠ” ê°ì²´ê°€ ì–´ë”˜ê°€ì— ì°¸ì¡°ê°€ ë‚¨ì•„ ìžˆì§€ë§Œ ë£¨íŠ¸ì—ì„œ ë‹¿ì§€ ì•Šìœ¼ë©´ íšŒìˆ˜ ëŒ€ìƒìœ¼ë¡œ ì—¬ê¸´ë‹¤.

> ë©”ëª¨ë¦¬ ê´€ë¦¬ëž€?
>
- GCëŠ” íž™ì— í• ë‹¹ëœ ì´í›„, ìˆ˜ì§‘ ê³¼ì •ì—ì„œ ì‚´ì•„ë‚¨ì€ ê°ì²´ë¥¼ ì„¸ëŒ€(Generational Collection) ë“±ì˜ ê·œì¹™ì— ë”°ë¼ ë‹¤ë¥¸ ì˜ì—­ìœ¼ë¡œ ì´ë™ ì‹œí‚¤ê±°ë‚˜, í•„ìš”ì‹œ ì••ì¶•ì„ ìˆ˜í–‰í•´ ë©”ëª¨ë¦¬ë¥¼ ì •ë¦¬í•œë‹¤.

## GC ìˆ˜ì§‘ ë™ìž‘ ê³¼ì •

GCëŠ” ì„¸ëŒ€ë³„(Young/Old)ë¡œ ìˆ˜ì§‘í•˜ëŠ” ê³¼ì •ì´ ì°¨ì´ê°€ ìžˆë‹¤. Young ì˜ì—­ì—ì„œ ì¼ì–´ë‚˜ëŠ” GCë¥¼ Minor GC, Old ì˜ì—­ì€ Major GCë¼ê³  í•œë‹¤. ê·¸ë¦¬ê³  Young, Old, Metaspace ì˜ì—­ê¹Œì§€ íž™ ì „ì²´ë¥¼ ì •ë¦¬í•˜ëŠ” ë¬´ê±°ìš´ ìž‘ì—…ì„ Full GCë¼ê³  í•œë‹¤.

### Young ì˜ì—­ ë™ìž‘ ê³¼ì •

Young ì˜ì—­ì—ì„œ Eden ì˜ì—­ì´ ê°€ë“ì°¨ê²Œ ë˜ë©´ Minor GCê°€ ê°ì²´ë¥¼ ìˆ˜ì§‘í•˜ê²Œ ëœë‹¤. ê·¸ ê³¼ì •ì—ì„œ Root Scanì‹œ ë„ë‹¬í•˜ì§€ ëª»í•œ ê°ì²´ëŠ” ë‚¨ì•„ìžˆê²Œ ë˜ê³ , ê·¸ ì´ì™¸ì— ê°ì²´ë“¤ì€ Survivor 1,2 ì¤‘ í•œê³³ìœ¼ë¡œ ì´ë™í•˜ê²Œ ëœë‹¤. í•œ ê°€ì§€ ì£¼ì˜í•  ê²ƒì€ Young GCì˜ ì´ë™ì€ Mark-sweepì´ ì•„ë‹ˆë¼ Copying ë°©ì‹ì´ë‹¤. ë˜í•œ Young GCëŠ” ìˆ˜ì§‘í•˜ê¸° ì „ì— Oldì—ì„œ Youngìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ì°¸ì¡°ë„ ê°™ì´ ë°˜ì˜í•œë‹¤.

ì´ë™ ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

1. Root ìŠ¤ìº” + Remembered Set ë°˜ì˜
2. ìƒì¡´ ê°ì²´ ê·¸ëž˜í”„ íŠ¸ë ˆì´ì‹± (ë„ë‹¬ ê°€ëŠ¥ íŒë³„)
3. ë³µì‚¬ + í¬ì›Œë”© í¬ì¸í„° ì„¤ì •
  - ì´ë•Œ Survivor ì˜ì—­ìœ¼ë¡œ ì´ë™
  - í¬ì›Œë”© í¬ì¸í„° : ê°ì²´ê°€ ì´ë™í•œ ê³³ í‘œì‹œ
4. ì°¸ì¡° ì—…ë°ì´íŠ¸(í¬ì¸í„° ìˆ˜ì •)
  - ì˜®ê²¨ì§„ ìƒˆ ì£¼ì†Œë¡œ ëª¨ë“  ì°¸ì¡°ë¥¼ ë°”ê¿ˆ
5. Eden ì˜ì—­ í†µì§¸ë¡œ Sweep

### Old ì˜ì—­ ë™ìž‘ ê³¼ì •

Old ì˜ì—­ì—ì„œì˜ ê°ì²´ ìˆ˜ì§‘ê³¼ì •ì„ ë³´ë©´ Full GCê°€ ì˜¤ëž˜ê±¸ë¦¬ëŠ” ì´ìœ ë¥¼ ì•Œ ìˆ˜ ìžˆë‹¤. Youngì€ Edenì„ í†µì§¸ë¡œ ë¹„ìš°ëŠ” ê·¸ë¦¼ì´ì§€ë§Œ OldëŠ” ì‚´ì•„ìžˆëŠ” ê°ì²´ê°€ ë§Žê³  í©ì–´ì ¸ ìžˆê¸° ë•Œë¬¸ì— ê³¼ì •ì´ ë” ë¬´ê²ë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— íšŒìˆ˜, ì´ë™ ê³¼ì • ì´ì™¸ì—ë„ ì••ì¶• ë˜ëŠ” ìž¬ë°°ì¹˜ ê³¼ì •ì´ ì´ë£¨ì–´ì ¸ì•¼ í•œë‹¤.
Old GCëŠ” í¬ê²Œ 4ë‹¨ê³„ë¡œ ì´ë£¨ì–´ì ¸ ìžˆë‹¤.

1. Mark (í‘œì‹œ)
2. Reclaim (íšŒìˆ˜)
3. Compact ë˜ëŠ” Evacuate (ì••ì¶• ë˜ëŠ” ì´ë™)
4. Reference Update (ì°¸ì¡° ìˆ˜ì •)

Old ì˜ì—­ì€ êµ¬í˜„ì²´ë§ˆë‹¤ Old ì˜ì—­ ìˆ˜ì§‘ ì•Œê³ ë¦¬ì¦˜ì´ ë‹¤ë¥´ë‹¤.

### Root Set

ì°¸ì¡° ê·¸ëž˜í”„ë¥¼ Tracingí•˜ì—¬ Reachable Objectë¥¼ íŒë³„í•œë‹¤.

**Reachable Object ì°¸ì¡° ì¡°ê±´**

1. Local Variable Section, Operand Stack ì— Object ì˜ Reference ì •ë³´ê°€ ìžˆì„ ê²½ìš°
2. Method Areaì— ë¡œë”©ëœ í´ëž˜ìŠ¤ ì¤‘ constant poolì— ìžˆëŠ” Reference ì •ë³´ë¥¼ í† ëŒ€ë¡œ Thread ì—ì„œ ì§ì ‘ ì°¸ì¡°í•˜ì§€ ì•Šì§€ë§Œ Constant poolì„ í†µí•´ ê°„ì ‘ linkë¥¼ í•˜ê³  ìžˆëŠ” ê²½ìš°
3. ì•„ì§ ë©”ëª¨ë¦¬ì— ë‚¨ì•„ ìžˆìœ¼ë©° Native Method Areaë¡œ ë„˜ê²¨ì§„ Objectì˜ Referenceê°€ JNI í˜•íƒœë¡œ ì°¸ì¡° ê´€ê³„ê°€ ìžˆëŠ” ê²½ìš°

## Hotspot JVMì˜ GC

**Hotspot JVMì˜ GC ë©”ì»¤ë‹ˆì¦˜**

1. ObjectëŠ” ìƒì„±ëœ í›„ ê¸ˆë°© Garbageê°€ ëœë‹¤.(High infantmotality)
2. Older Objectê°€ Younger Objectë¥¼ ì°¸ì¡°í•  ì¼ì€ ë“œë¬¼ë‹¤.

Hotspot JVMì˜ GC ë©”ì»¤ë‹ˆì¦˜ì€ ê²½í—˜ì  ê¸°ë°˜ì— ì˜í•´ ì„¸ì›Œì§„ ê°€ì„¤ë“¤ì´ë¼ ë³¼ ìˆ˜ ìžˆë‹¤.

ì²«ë²ˆì§¸ ê°€ì„¤ì€ ìƒˆë¡œ í• ë‹¹ëœ Objectê°€ ëª¨ì¸ ê³³ì€ ë‹¨íŽ¸í™” ë°œìƒ í™•ë¥ ì´ ë†’ë‹¤ê³  íŒë‹¨ëœë‹¤. ê·¸ëž˜ì„œ Compaction ìž‘ì—…ì„ í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— Eden Areaë¥¼ ë§Œë“¤ê²Œ ëê³ , GC ì‹œ Live Objectë“¤ì„ í”¼ì‹ ì‹œí‚¤ëŠ” Survivor Areaë¥¼ ë”°ë¡œ êµ¬ì„±í•œ ê²ƒì´ë‹¤.

GCì‹œ Live Objectë¥¼ íŒë³„í•˜ëŠ” Marking ìž‘ì—…ì„ í•˜ê²Œ ë˜ëŠ”ë°, ì´ëŠ” ê±°ì˜ Youngì˜ì—­ì—ì„œë§Œ ìˆ˜í–‰ëœë‹¤. ì „ì²´ Heapì— ëŒ€í•´ ìˆ˜í–‰í•˜ê²Œ ë˜ë©´ ê¸´ Suspend Timeì„ ê°€ì ¸ê°€ê²Œ ë˜ê¸° ë•Œë¬¸ì´ë‹¤. ê·¸ëŸ°ë° ë§Œì•½, Olderì—ì„œ Young ì˜ì—­ì— ìžˆëŠ” ê°ì²´ë¥¼ ì°¸ì¡°í•˜ê²Œ ëœë‹¤ë©´ Marking ìž‘ì—…ì´ Old ì˜ì—­ê¹Œì§€ ì´ì–´ì ¸ Suspend Time ê¸¸ì–´ì§„ë‹¤. ì´ëŸ¬í•œ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ì„œ Hotspot JVMì€ Card Tableì´ëž€ ìž¥ì¹˜ë¥¼ ë§ˆë ¨í–ˆë‹¤.

### Card Table

Old ì˜ì—­ì˜ ë©”ëª¨ë¦¬ë¥¼ ëŒ€í‘œí•˜ëŠ” ë³„ë„ ë©”ëª¨ë¦¬ êµ¬ì¡°ì´ë‹¤. ë§Œì•½ Young ì˜ì—­ì— Objectë¥¼ ì°¸ì¡°í•˜ëŠ” Old ì˜ì—­ Objectê°€ ìžˆë‹¤ë©´ Old ì˜ì—­ Object ì‹œìž‘ì£¼ì†Œì— ì¼ì¢…ì˜ Flag(Dirty)ë¥¼ í‘œì‹œí•˜ê³  í•´ë‹¹ ë‚´ìš©ì„ Card Tableì— ê¸°ë¡í•œë‹¤. ì¦‰, ì°¸ì¡°ê°€ ìžˆë‹¤ë©´ Card Tableì„ ë³´ê³  ë¹ ë¥´ê²Œ ê´€ê³„ë¥¼ íŒŒì•…í•  ìˆ˜ ìžˆê²Œ í•œ ê²ƒì´ë‹¤.

- Card ë©”ëª¨ë¦¬ : Old Area ë©”ëª¨ë¦¬ 512bytes ë‹¹ 1byteì˜ ê³µê°„ì„ ì°¨ì§€

### TLAB(Thread-Local Allocation Buffers)

TLABëŠ” ë©”ëª¨ë¦¬ í• ë‹¹ ìž‘ì—…ì„ í•  ë•Œ ì“°ë ˆë“œë³„ë¡œ ì£¼ì–´ì§€ëŠ” Local Bufferì´ë‹¤.
TLABëŠ” GCê°€ ë°œìƒí•˜ê±°ë‚˜ ê°ì²´ê°€ ê° ì˜ì—­ì— ë‹¤ë¥¸ ì˜ì—­ìœ¼ë¡œ ì´ë™í•  ë•Œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë³‘ëª©ì´ ë°œìƒí•˜ëŠ”ë° ì´ë¥¼ í†µí•´ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ” ë©”ëª¨ë¦¬ í• ë‹¹ ìž‘ì—…ì„ ê°€ëŠ¥í•˜ê²Œ í•œë‹¤.

### GC ì¢…ë¥˜

### Seral Collector

- Young / Old Generation ëª¨ë‘ Serialë¡œ Single CPUë¥¼ ì‚¬ìš©í•œë‹¤.
- Client Classì˜ ê¸°ë³¸ Collector ì´ë©° í˜„ìž¬ ê±°ì˜ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” Collectorì´ë‹¤.

### Parallel Collector

Youngì˜ì—­ì—ì„œ ì»¬ë ‰ì…˜ì„ ë³‘ë ¬ ì²˜ë¦¬ë¥¼ í•˜ëŠ” GCì´ë‹¤. ì¦‰, Multi Threadê°€ ë™ì‹œì— GCë¥¼ ìˆ˜í–‰í•œë‹¤.

- throughput collectorë¼ê³ ë„ í•œë‹¤.
- ë‹¤ë¥¸ CPUê°€ ëŒ€ê¸° ìƒíƒœë¡œ ë‚¨ì•„ìžˆëŠ” ê²ƒì„ ìµœì†Œí™”í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•œë‹¤.
- ë§Žì€ CPUê°€ ì‚¬ìš©ë˜ì§€ë§Œ, GCì˜ ë¶€í•˜ë¥¼ ì¤„ì´ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ ì²˜ë¦¬ëŸ‰ì„ ì¦ê°€ì‹œí‚¬ ìˆ˜ ìžˆë‹¤.
- Server Classì˜ JVMì—ì„œ ê¸°ë³¸ Collectorì´ë‹¤.

Eden, Survivor ì˜ì—­ì˜ Copy ìž‘ì—…ì„ ì—¬ëŸ¬ Threadê°€ ë™ì‹œ ìˆ˜í–‰í•œë‹¤. íˆ¬ìž…í•œ Resource ë§Œí¼ Suspend Timeì„ ë‹¨ì¶•í•  ìˆ˜ ìžˆë‹¤. í•˜ì§€ë§Œ, Multi Threadì¸ ë§Œí¼ Corruptionì´ ë°œìƒí•˜ëŠ”ë°, Hotspotì€ ì´ë¥¼ PLABì´ë¼ëŠ” Promotion Bufferë¥¼ ë§ˆë ¨í•´ í•´ê²°í•˜ê³  ìžˆë‹¤.

> PLAB(Parallel Allocation Buffer)
GC Threadê°€ Promotionì‹œ ì‚¬ìš©í•˜ëŠ” ë²„í¼ì´ë‹¤. Old ì˜ì—­ì˜ ì¼ì •ë¶€ë¶„ì„ í• ë‹¹ ë°›ê³  ì‚¬ìš© í›„ ë‹¤ì‹œ Bufferë¥¼ ìž¬í• ë‹¹í•œë‹¤.
>

### CMS Collector

CMS CollectorëŠ” Suspend Timeì„ ë¶„ì‚°í•˜ì—¬ ì‘ë‹µì‹œê°„ì„ ê°œì„ í•œë‹¤.

- low-latency Collectorë¡œë„ ì•Œë ¤ì ¸ ìžˆë‹¤.
- íž™ ë©”ëª¨ë¦¬ ì˜ì—­ì˜ í¬ê¸°ê°€ í´ ë•Œ ì í•©í•˜ë‹¤.
- GCì˜ Pause Timeì„ ì¤„ì´ëŠ” ëª©ì ì´ ìžˆë‹¤.
- Young Areaì—ëŠ” Parallel Copy ì•Œê³ ë¦¬ì¦˜, Old AreaëŠ” Concurrent Mark-Sweep ì•Œê³ ë¦¬ì¦˜ì´ ì‚¬ìš©ëœë‹¤.

**Old Area - Concurrent Mark-sweep ì•Œê³ ë¦¬ì¦˜**

Initial Mark Phase - Concurrent Mark Phase - Remark Mark Phase - Concurrent Sweep Phase ë‹¨ê³„ë¥¼ ê±°ì¹œë‹¤.

- Initial Mark Phase
  - Single Threadë§Œ ì‚¬ìš©
  - ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì¤‘ì§€ëœë‹¤.
  - ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì§ì ‘ ì°¸ì¡°ë˜ëŠ” Objectë§Œ Markí•œë‹¤.
  - Suspend ìƒíƒœì§€ë§Œ ë¹ ë¥´ë‹¤.
- Concurrent Mark Phase
  - Single Threadë§Œ ì‚¬ìš©
  - ì• í”Œë¦¬ì¼€ì´ì…˜ ìˆ˜í–‰
  - GC Thread ì™¸ Working ThreadëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ìˆ˜í–‰ì´ ê°€ëŠ¥í•˜ë‹¤. Initial Mark phaseì—ì„œ ì„ ë³„ëœ Live Objectê°€ ì°¸ì¡°í•˜ê³  ìžˆëŠ” Objectë¥¼ ì¶”ì í•´ Mark í•œë‹¤.
- Remark Phase
  - Multi Thread ì‚¬ìš©
  - ì• í”Œë¦¬ì¼€ì´ì…˜ ì¤‘ì§€
  - ì´ë¯¸ Marking ëœ Object ë‹¤ì‹œ ì¶”ì í•´ Live ì—¬ë¶€ë¥¼ í™•ì •í•œë‹¤.
  - ëª¨ë“  Resource íˆ¬ìž…
- Concurrent Sweep Phase
  - Single Threadë§Œ ì‚¬ìš©í•œë‹¤.
  - ì• í”Œë¦¬ì¼€ì´ì…˜ ìˆ˜í–‰
  - í™•ì •ëœ Live Objectë¥¼ ì œì™¸í•œ Objectë¥¼ ì§€ìš´ë‹¤.
  - Compaction ìž‘ì—…ì€ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤.
    - Compaction ìž‘ì—…ì€ Heapì˜ Suspendë¥¼ ìœ ë°œ
  - ë°˜ë³µëœ Sweepìœ¼ë¡œ ë°œìƒí•œ ë‹¨íŽ¸í™”ëŠ” Free Listë¥¼ ì‚¬ìš©í•˜ì—¬ ì¤„ì´ë ¤ê³  í•œë‹¤.

> Free List
Old Areaì˜ í˜„ìž¬ ì‚¬ìš©ê°€ëŠ¥í•œ ë¹ˆ ê³µê°„ ëª©ë¡. ìŠ¹ê²©ëœ Objectì— ë§žëŠ” í¬ê¸°ë¥¼ Free Listì—ì„œ íƒìƒ‰í•œë‹¤.
ë˜í•œ, Object ì‚¬ì´ì¦ˆë¥¼ í†µê³„í™”(í‰ê· )í•˜ì—¬, Free Memory ë¸”ë¡ì„ ë¶™ì´ê±°ë‚˜ ë‚˜ëˆ„ëŠ” ìž‘ì—…ì„ ìˆ˜í–‰í•´ ì ì ˆí•œ Sizeë¥¼ ìœ ì§€í•œë‹¤.
>

**CMS Collectorì˜ ë¬¸ì œ**

Floating Garbage ë¬¸ì œ

Initial Markì´ Live Objectë¥¼ íŒë³„í•œ í›„ Concurrent Mark ë‹¨ê³„ì—ì„œ Old ì˜ì—­ì— ìŠ¹ê²©ë˜ì–´ ë“¤ì–´ì™€ Dead Objectìž„ì—ë„ ë¶ˆêµ¬í•˜ê³  GC ìˆ˜í–‰ íŒë³„ ì—¬ë¶€ ëŒ€ìƒì— í¬í•¨ë˜ì§€ ì•Šì•„ íšŒìˆ˜ë˜ì§€ ì•Šì€ Dead Objectë¥¼ ë§í•œë‹¤.

ì´ëŠ” Old Areaë¥¼ í™•ìž¥í•˜ê²Œ ë§Œë‹¤ëŠ” ìš”ì¸ì´ ëœë‹¤.

ì´ì™¸ì˜ ë¬¸ì œ

- CMS CollectorëŠ” Suspend Timeì„ ì™„ë²½í•˜ê²Œ ì—†ì• ì§€ ëª»í•œë‹¤. Young Area GCì™€ Remark phaseë¥¼ ì—°ë‹¬ì•„ ìˆ˜í–‰í•˜ë©´ ì˜ë„í•œ Suspend Timeë³´ë‹¤ ê¸¸ì–´ì§ˆ ìˆ˜ ìžˆë‹¤. ê·¸ëž˜ì„œ CMSëŠ” Collectionì—ì„œ Scheduleì„ ê³ ë ¤í•œë‹¤.

**Old Area - Parallel Compaction ì•Œê³ ë¦¬ì¦˜**

### G1 Collector

![img_2.png](../../image/java/java_11_04.png)

**G1 Collector GC ë©”ì»¤ë‹ˆì¦˜**

- G1 CollectorëŠ” ë¬¼ë¦¬ì ìœ¼ë¡œ Generation êµ¬ë¶„ì„ ì—†ì• ê³ , Regionì´ë¼ëŠ” ì˜ì—­ìœ¼ë¡œ ì „ì²´ Heapì„ ê· ë“±í•˜ê²Œ 1Mbytes ë‹¨ìœ„ë¡œ ë‚˜ëˆ ì„œ ê´€ë¦¬í•˜ê²Œ ëœë‹¤.
- Garbage Firstë¼ëŠ” ì˜ë¯¸ëŠ” Garbageë¡œë§Œ ê½‰ ì°¬ Regionë¶€í„° Collectionì„ ì‹œìž‘í•œë‹¤ëŠ” ì˜ë¯¸ë¡œ ë°œê²¬ ì¦‰ì‹œ ë°”ë¡œ Collection í•œë‹¤.
- Regionì€ ë¬¼ë¦¬ì  ê°œë…ìœ¼ë¡œ Young AreaëŠ” Objectê°€ Allocation Regionì˜ ì§‘í•©, Promotion ë˜ëŠ” Regionì˜ ì§‘í•©ì„ Old Areaë¼ê³  í•œë‹¤.
- Remember setì€ Region ì™¸ë¶€ì—ì„œ ë“¤ì–´ì˜¤ëŠ” ì°¸ì¡° ì •ë³´ë¥¼ ê°€ì§„ë‹¤. G1ì€ Remember setì„ ê°€ì§€ê³  Region ë‚´ì— ì°¸ì¡°ë¥¼ ê´€ë¦¬í•œë‹¤. ì´ë¡œ ì¸í•´ Marking ìž‘ì—… íš¨ìœ¨ì„ ë†’ì¼ ìˆ˜ ìžˆë‹¤.

**Garbage First Collection**

1. Evacuation Pause (Young GC)
   Young Region(Eden + Survivor)ì—ì„œ ì‚´ì•„ìžˆëŠ” ê°ì²´ë¥¼ ë‹¤ë¥¸ Regionìœ¼ë¡œ ë³µì‚¬í•˜ê³ , ë¹„ì›Œì§„ Regionì„ ìž¬ì‚¬ìš© ê°€ëŠ¥ ìƒíƒœë¡œ ë§Œë“œëŠ” STW ë‹¨ê³„
2. Concurrent Mark - Marking
   ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ê³¼ ë™ì‹œì— Old Region ì „ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì‚´ì•„ìžˆëŠ” ê°ì²´ë¥¼ ì¶”ì í•˜ì—¬ íž™ì˜ ìƒì¡´ ê°ì²´ ë¶„í¬ë¥¼ ê³„ì‚°í•˜ëŠ” ë‹¨ê³„
3. Current Mark - Remarking
   Concurrent Mark ì¤‘ ë³€ê²½ëœ ê°ì²´ ì°¸ì¡°ë¥¼ ìµœì¢… ë°˜ì˜í•˜ê¸° ìœ„í•´ ì§§ê²Œ STWë¡œ ì •í™•í•œ ìƒì¡´ ê°ì²´ ì§‘í•©ì„ í™•ì •í•˜ëŠ” ë‹¨ê³„
4. Old Region Reclaim - Remarking
   ë§ˆí‚¹ ê²½ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ íšŒìˆ˜ ê°€ì¹˜ê°€ ë†’ì€ Old Regionì„ ì„ ë³„í•˜ê³ , ì™„ì „ížˆ ë¹„ì–´ìžˆëŠ” Regionì„ ì¦‰ì‹œ í•´ì œí•˜ëŠ” ë‹¨ê³„
5. Old Region Reclaim - Evacuation Pause
   Young Regionê³¼ ì¼ë¶€ Old Regionì„ í•¨ê»˜ Evacuationí•˜ì—¬, íšŒìˆ˜ ëŒ€ìƒ Old ê°ì²´ë¥¼ ë‹¤ë¥¸ Regionìœ¼ë¡œ ì´ë™ì‹œí‚¤ê³  í•´ë‹¹ Regionì„ ë¹„ìš°ëŠ” STW ë‹¨ê³„
6. Compaction Phase
   ê°ì²´ë¥¼ ì—°ì†ëœ Regionìœ¼ë¡œ ìž¬ë°°ì¹˜í•˜ì—¬ ë‹¨íŽ¸í™”ë¥¼ ì œê±°í•˜ê³ , í° ì—°ì† ë©”ëª¨ë¦¬ ë¸”ë¡ì„ í™•ë³´í•˜ëŠ” ì •ë¦¬ ë‹¨ê³„
   Concurrent ìž‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.

>
>
>
> G1ì€
> ðŸ‘‰ Youngë§Œ ì •ë¦¬ â†’
> ðŸ‘‰ ì „ì²´ Old ìƒì¡´ ë¶„ì„ â†’
> ðŸ‘‰ íšŒìˆ˜ ê°€ì¹˜ ë†’ì€ Oldë§Œ ì„ íƒ â†’
> ðŸ‘‰ ì ì§„ì ìœ¼ë¡œ íšŒìˆ˜ â†’
> ðŸ‘‰ í•„ìš” ì‹œ Compaction
>

### ì •ë¦¬

**A) Serial / Parallel Old (ì²˜ë¦¬ëŸ‰ ìš°ì„ , ë‹¨ìˆœ)**

- Old ìˆ˜ì§‘: **Markâ€“Sweepâ€“Compact**(ëŒ€ì²´ë¡œ STW)
- ìž¥ì : ë‹¨ìˆœ, ì²˜ë¦¬ëŸ‰ ì¢‹ì„ ìˆ˜ ìžˆìŒ
- ë‹¨ì : íž™ í¬ë©´ pauseê°€ ê¸¸ì–´ì§

(ì¦‰, Oldë¥¼ â€œí•œ ë²ˆì— í¬ê²Œ ë©ˆì¶°ì„œâ€ ì •ë¦¬)

**B) CMS (ì˜ˆì „ì˜ ì €ì§€ì—° ì „ëžµ, í˜„ìž¬ëŠ” ì—­ì‚¬ì )**

- Old ìˆ˜ì§‘: **Concurrent Mark + Sweep**
- ìž¥ì : pause ì¤„ì´ë ¤ê³  â€œë§ˆí‚¹ì„ ë™ì‹œì—â€ í•¨
- ë‹¨ì : **ì••ì¶•(compaction)ì´ ê¸°ë³¸ì´ ì•„ë‹ˆë¼ ë‹¨íŽ¸í™”**ê°€ ëˆ„ì  â†’ Full GCë¡œ íŠˆ ìˆ˜ ìžˆìŒ

(ìš”ì : ë™ì‹œ ë§ˆí‚¹ì€ í–ˆì§€ë§Œ â€œë‹¨íŽ¸í™” í•´ê²°â€ì´ ì•½í–ˆìŒ)

**C) G1 (Region ê¸°ë°˜, Oldë¥¼ â€œì¡°ê¸ˆì”©â€)**

- OldëŠ” â€œê³ ì • êµ¬ì—­â€ì´ ì•„ë‹ˆë¼ **Old ì—­í• ì„ ê°€ì§„ ì—¬ëŸ¬ Region**
- Old ìˆ˜ì§‘ì€ **Mixed GC**ê°€ í•µì‹¬:
  - Young ìˆ˜ì§‘í•  ë•Œ **ì¼ë¶€ Old regionë„ ê°™ì´ evacuation(ì‚´ì•„ìžˆëŠ” ê°ì²´ ì´ë™ í›„ íšŒìˆ˜)**
- ë§ˆí‚¹ì€ **Concurrent Marking**
- ìž¥ì : Oldë¥¼ í†µì§¸ë¡œ ë¯¸ëŠ” ëŒ€ì‹  ë‚˜ìœ regionë¶€í„° ì¡°ê¸ˆì”© ì¹˜ì›€
- ë‹¨ì : ìƒí™©ì— ë”°ë¼ **evacuation ì‹¤íŒ¨ â†’ Full GC** ê°€ëŠ¥

(ìš”ì : Oldë¥¼ â€˜ì„ ë³„ì ìœ¼ë¡œâ€™ ì¹˜ìš°ê³ , ì´ë™ìœ¼ë¡œ ë‹¨íŽ¸í™”ë„ ì™„í™”)

**D) ZGC / Shenandoah (ìµœì‹  ì €ì§€ì—°, ì´ë™ë„ ë™ì‹œ)**

- Old ìˆ˜ì§‘: **Concurrent Mark + Concurrent Relocation(ì´ë™)**
- ìž¥ì : íž™ì´ ì»¤ë„ pauseë¥¼ ë§¤ìš° ì§§ê²Œ ìœ ì§€í•˜ëŠ” ëª©í‘œ
- í•µì‹¬ ê¸°ìˆ : **ì½ê¸°/ì“°ê¸° ìž¥ë²½(load barrier ë“±)ìœ¼**ë¡œ í¬ì¸í„° ì—…ë°ì´íŠ¸ë¥¼ ë™ì‹œ ìˆ˜í–‰
- ë‹¨ì : ìž¥ë²½ ë¹„ìš©/í™˜ê²½ ì œì•½ ë“±(ì¼ë°˜ì ìœ¼ë¡œ CPU ì˜¤ë²„í—¤ë“œ trade-off)

## IBM JVM Collector

### Throughput ìµœì í™” Collector

### Response Time ìµœì í™” Collector

### Generational Concurrent Collector

### Sub Pool Collector

---

## Flab AI ì§ˆì˜ì‘ë‹µ

- 1. **JVMì˜ ë©”ëª¨ë¦¬ êµ¬ì¡°ì™€ GC(ê°€ë¹„ì§€ ì»¬ë ‰ì…˜) ê¸°ì „, ê·¸ë¦¬ê³  GC íŠœë‹ ì‹œ ê³ ë ¤í•´ì•¼ í•  ì£¼ìš” íŒŒë¼ë¯¸í„°ì™€ ê·¸ ì˜í–¥ì— ëŒ€í•´ ì„¤ëª…í•˜ì„¸ìš”.**

JVM ë©”ëª¨ë¦¬ êµ¬ì¡°ëŠ” Runtime Data Areaë¼ê³  í•˜ëŠ”ë°, ë³´í†µ Thread ì˜ì—­ê³¼ Non-Thread ì˜ì—­ìœ¼ë¡œ ë‚˜ë‰œë‹¤. Thread ì˜ì—­ì€ ê° ì“°ë ˆë“œ ë§ˆë‹¤ ìƒì„±ë  ë•Œ í• ë‹¹ë˜ëŠ” ì˜ì—­ìœ¼ë¡œ JVM Stacks, PC Register, Native Method Stacks ê°€ ìžˆë‹¤. Non-Thread ì˜ì—­ì€ ëª¨ë“  ì“°ë ˆë“œê°€ ê³µìœ í•  ìˆ˜ ìžˆëŠ” ì˜ì—­ìœ¼ë¡œ Method Area, Heapì´ ìžˆë‹¤.

GCëŠ” JVM ë©”ëª¨ë¦¬ ì¤‘ì— Heap ì˜ì—­ì„ ê´€ë¦¬í•œë‹¤. GCëŠ” Heapì— í• ë‹¹ëœ ê°ì²´ë“¤ì„ ê´€ë¦¬í•˜ëŠ”ë° ì£¼ë¡œ ë” ì´ìƒ ì°¸ì¡° ê·¸ëž˜í”„ì— ë„ë‹¬í•  ìˆ˜ ì—†ëŠ” ê°ì²´ë“¤ì„ ìˆ˜ì§‘í•˜ì—¬ íšŒìˆ˜í•˜ëŠ” ìž‘ì—…ì„ í•œë‹¤. ë˜í•œ, ê·¸ ì™¸ì— ìˆ˜ì§‘ë˜ì§€ ì•Šì€ ê°ì²´ë“¤ì„ ì •ì±…/ëª©í‘œì— ë”°ë¼ì„œ ë‹¤ë¥¸ ì˜ì—­ìœ¼ë¡œ ì´ë™ì‹œí‚¤ê±°ë‚˜, í•„ìš”ì‹œ ì••ì¶• ìž‘ì—…ì„ í•˜ê²Œ ëœë‹¤.

GCëŠ” ì„¸ëŒ€ë¼ëŠ” ê·œì¹™ì„ ì ìš©ì— ë©”ëª¨ë¦¬ ì˜ì—­ì„ êµ¬ë¶„í•˜ëŠ”ë° í¬ê²Œ Yuong/Old ì˜ì—­ì´ ì¡´ìž¬í•œë‹¤. Young ì˜ì—­ì—ì„œ Edenì´ë¼ëŠ” ì˜ì—­ì´ ì£¼ë¡œ ìƒˆë¡œìš´ ê°ì²´ê°€ í• ë‹¹ë˜ëŠ” ì˜ì—­ì´ë‹¤. ê·¸ë¦¬ê³  Young ì˜ì—­ì´ ê°€ë“ ì°¼ì„ ë•Œ GC ê°ì²´ë¥¼ íƒìƒ‰í•´ì„œ íšŒìˆ˜í•  ê°ì²´ë“¤ì„ ì°¾ê³  ê·¸ ì™¸ì— ë‚˜ë¨¸ì§€ë“¤ì€ Survivor ì˜ì—­ìœ¼ë¡œ ì´ë™ì‹œí‚¨ë‹¤. ê·¸ë¦¬ê³  Survivor ì˜ì—­ë„ ê°€ë“ì°¼ì„ ë•Œ ì˜¤ëž˜ë„ë¡ ì‚´ì•„ë‚¨ì€ ê°ì²´ë“¤ì€ Old ì˜ì—­ìœ¼ë¡œ ì´ë™ì‹œí‚¤ê²Œ ëœë‹¤.

ì´ë ‡ê²Œ ê° ì˜ì—­ì´ ê°€ë“ì°°ë•Œ í˜¹ì€ ì–´ë– í•œ ì´ìœ ë¡œ ê°ì²´ íšŒìˆ˜ ë° ì´ë™(ìŠ¹ê²©)ì„ í•˜ëŠ” ìˆ˜ì§‘ ê³¼ì •ì´ ì¼ì–´ë‚ ë•ŒëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë©ˆì¶¤ í˜„ìƒì´ ì¼ì–´ë‚œë‹¤. ì´ë¥¼ Stop The World(STW)ë¼ í•œë‹¤.

GC ìˆ˜ì§‘ì´ ìžì£¼ ì¼ì–´ë‚  ê²½ìš° STW ì‹œê°„ì´ ëŠ˜ì–´ë‚˜ê²Œ ë˜ë©´ ì‹¤í–‰ ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì‚¬ìš©ìž ì‘ë‹µ Latencyê°€ ê¸¸ì–´ì§ˆ ìˆ˜ ë°–ì— ì—†ë‹¤. GC íŠœë‹ì´ëž€ ì´ ì‹œê°„ì„ ì¤„ì´ëŠ” ìž‘ì—…ì„ ë§í•œë‹¤.

GC íŠœë‹ì‹œ ê³ ë ¤í•´ì•¼í•  íŒŒë¼ë¯¸í„°ëŠ” GCëŠ” ë©”ëª¨ë¦¬ì™€ ì—°ê´€ë˜ì–´ìžˆìœ¼ë‹ˆ ë©”ëª¨ë¦¬ ê´€ë ¨ ì˜µì…˜ë“¤ì„ ê³ ë ¤í•´ì•¼ í•œë‹¤. ì£¼ë¡œ íž™ ì˜ì—­ í¬ê¸°ë¥¼ ì„¤ì •í•˜ëŠ” -Xms, -Xmxê°€ ìžˆê³  ì„¸ëŒ€ ì˜ì—­ì˜ í¬ê¸°ë¥¼ ì„¤ì •í•˜ëŠ” -XX:NewRatio, -XX:NewSize, -XX:SurivorRatioê°€ ìžˆë‹¤.

>
>
> - ë‹µë³€ì— ëŒ€í•œ í‰ê°€ : 80ì 
> - í‰ê°€ ì´ìœ  : JVMì˜ ë©”ëª¨ë¦¬ êµ¬ì¡°ì™€ GCì— ëŒ€í•œ ì „ë°˜ì ì¸ ì´í•´ê°€ ìž˜ ë˜ì–´ ìžˆìœ¼ë©°, ì„¸ëŒ€ë¼ëŠ” ê°œë…ê³¼ Young/Old ì˜ì—­, ê·¸ë¦¬ê³  Stop The World í˜„ìƒì— ëŒ€í•œ ì„¤ëª…ì´ ìƒì„¸ížˆ ì´ë£¨ì–´ì¡ŒìŠµë‹ˆë‹¤. ë˜í•œ GC íŠœë‹ì‹œ ê³ ë ¤í•´ì•¼ í•  ì£¼ìš” íŒŒë¼ë¯¸í„°ì— ëŒ€í•œ ì„¤ëª…ë„ ìž˜ ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.
> - ê²€ìƒ‰ í‚¤ì›Œë“œ : JVM Memory Structure, Garbage Collection in Java, GC Tuning Parameters
- 2. ê¼¬ë¦¬ì§ˆë¬¸: GC íŠœë‹ì—ì„œ ì„¸ëŒ€ í¬ê¸° ë¹„ìœ¨ì„ ì¡°ì ˆí•˜ëŠ” -XX:NewRatio ì˜µì…˜ì— ëŒ€í•´ ì¢€ ë” ìžì„¸ížˆ ì„¤ëª…í•´ë³´ì„¸ìš”.

-XX:NewRatioëŠ” ì„¸ëŒ€ í¬ê¸° ë¹„ìœ¨ì„ ì¡°ì ˆí•˜ëŠ” ì˜µì…˜ìœ¼ë¡œ Newì˜ì—­ê³¼ Old ì˜ì—­ì˜ ë¹„ìœ¨ì„ ì„¤ì •í•œë‹¤. ì´ ì˜µì…˜ì´ ì–´ë–»ê²Œ ì„¤ì •í•˜ëŠëƒì— ë”°ë¼ GC ì„±ëŠ¥ì— ë§Žì€ ì°¨ì´ê°€ ë°œìƒí•œë‹¤.

-XX:NewRatio=2 ë¡œ ì„¤ì •í•˜ë©´ Newì˜ì—­ 1 : Old ì˜ì—­ 2ë¡œ ì„¤ì •ëœë‹¤.
Oldì˜ì—­ ë¹„ìœ¨ì´ ì»¤ì§€ë©´ GCê°€ ì ê²Œ ì¼ì–´ë‚˜ë‚˜ ì†ë„ê°€ ëŠë ¤ì§„ë‹¤.
ì „ë°˜ì ìœ¼ë¡œ NewRatioê°’ì´ 2ë‚˜ 3ì¼ë•Œì˜ GCìƒí™©ì´ ì¢‹ì„ ìˆ˜ê°€ ìžˆë‹¤.

>
>
>
> ë‹µë³€ì— ëŒ€í•œ í‰ê°€ : 90ì 
>
> - í‰ê°€ ì´ìœ  : -XX:NewRatio ì˜µì…˜ì— ëŒ€í•œ ì„¤ëª…ì´ ìƒì„¸ížˆ ì´ë£¨ì–´ì¡Œê³ , ì˜µì…˜ ê°’ì— ë”°ë¼ GC ì„±ëŠ¥ì— ì–´ë–¤ ì˜í–¥ì„ ì£¼ëŠ”ì§€ ìž˜ ì„¤ëª…í•˜ì˜€ìŠµë‹ˆë‹¤.
> - ê²€ìƒ‰ í‚¤ì›Œë“œ : Java -XX:NewRatio option, Java GC performance tuning with -XX:NewRatio
>
> ê¼¬ë¦¬ì§ˆë¬¸: -XX:NewRatio ê°’ì´ ë§¤ìš° ë‚®ê±°ë‚˜ ë§¤ìš° ë†’ì„ ë•Œ ì–´ë– í•œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìžˆì„ê¹Œìš”?
>
- 3. -XX:NewRatio ê°’ì´ ë§¤ìš° ë‚®ê±°ë‚˜ ë§¤ìš° ë†’ì„ ë•Œ ì–´ë– í•œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìžˆì„ê¹Œìš”?

ê°’ì´ ë§¤ìš° ë‚®ìœ¼ë©´ Youngì˜ì—­ì´ ì»¤ì§€ë¯€ë¡œ GC ë°œìƒ íšŸìˆ˜ê°€ ì ì–´ì§ˆ ìˆ˜ ìžˆë‹¤. í•˜ì§€ë§Œ, Young ì˜ì—­ì˜ í¬ê¸°ê°€ ì»¤ì§„ë‹¤ëŠ” ê²ƒì€ Minor GCê°€ ë°œìƒí•  ë•Œ íƒìƒ‰í•´ì•¼í•  ê°ì²´ë“¤ë„ ê·¸ëž˜ì„œ Minor GCê°€ í•œë²ˆ ì¼ì–´ë‚  ë•Œ STW ì‹œê°„ì´ ëŠ˜ì–´ë‚  ìˆ˜ ìžˆë‹¤. ê·¸ë¦¬ê³  Youngì—ì„œ ì‚´ì•„ë‚¨ì€ ê°ì²´ë“¤ì€ ê²°êµ­ Oldë¡œ ê°€ê²Œ ë˜ëŠ”ë° Old í¬ê¸°ê°€ ìž‘ìœ¼ë©´ ì´ë™ë  í™•ë¥ ì´ ì ì–´ì§€ê³ , ë˜í•œ Full GCê°€ ìžì£¼ ì¼ì–´ë‚˜ê²Œ ë  ìˆ˜ ìžˆë‹¤. ì´ëŠ” ìž¥ìˆ˜ ê°ì²´ê°€ ë§Žì€ ì„œë¹„ìŠ¤ë¼ë©´ íŠ¹ížˆ ì•…í™”ëœë‹¤.

ê·¸ë ‡ë‹¤ê³  í•´ì„œ ë§¤ìš° ë†’ì€ ê°’ì„ ì„¤ì •í•œë‹¤ê³  ì¢‹ì•„ì§€ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤. . ê°’ì„ ë§¤ìš° ë†’ê²Œ ì„¤ì •í•œë‹¤ë©´, Young ì˜ì—­ì€ ìž‘ì•„ì§€ê³  OldëŠ” ë§¤ìš° ì»¤ì§„ë‹¤. ê·¸ë ‡ê²Œ ë˜ë©´ Minor GCê°€ ìžì£¼ ë°œìƒí•˜ê²Œ ë˜ê³ , ë˜í•œ Young ì˜ì—­ í¬ê¸°ê°€ ìž‘ìœ¼ë‹ˆ Oldì˜ì—­ìœ¼ë¡œ ì´ë™ì´ ë¹¨ë¼ì ¸ Oldì˜ì—­ë„ ë¹¨ë¦¬ íƒ€ì´íŠ¸í•´ì§ˆ ê°€ëŠ¥ì„±ì´ ìžˆë‹¤. ë˜í•œ FullGC ìˆ˜ì§‘ ì´ë²¤íŠ¸ê°€ ë¬´ê±°ì›Œì ¸ STW ì‹œê°„ë„ ëŠ˜ì–´ë‚˜ê²Œ ëœë‹¤.

>
>
> - ë‹µë³€ì— ëŒ€í•œ í‰ê°€ : 100ì 
> - í‰ê°€ ì´ìœ  : -XX:NewRatio ê°’ì´ ë§¤ìš° ë‚®ê±°ë‚˜ ë§¤ìš° ë†’ì„ ë•Œ ë°œìƒí•  ìˆ˜ ìžˆëŠ” ë¬¸ì œì— ëŒ€í•´ ìƒì„¸ížˆ ì„¤ëª…í•˜ì˜€ê³ , ê°ê°ì˜ ìƒí™©ì—ì„œì˜ GC ë™ìž‘ ë° ì˜í–¥ì„ ìž˜ íŒŒì•…í•˜ê³  ì„¤ëª…í–ˆìŠµë‹ˆë‹¤.
> - ê²€ìƒ‰ í‚¤ì›Œë“œ : Java -XX:NewRatio setting effects, Java Garbage Collection tuning with different -XX:NewRatio values
- 4. **JVMì˜ Young/Old/Metaspace ê°ê°ì˜ ì—­í• ê³¼ GCê°€ ì´ë“¤ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì€ ë¬´ì—‡ì¸ê°€ìš”?**

Young : ì´ ì˜ì—­ì€ ìƒˆë¡œìš´ ê°ì²´ê°€ í• ë‹¹ë˜ê±°ë‚˜ í• ë‹¹ëœì§€ ì–¼ë§ˆ ì§€ë‚˜ì§€ ì•Šì€ ê°ì²´ë“¤ì´ í• ë‹¹ë˜ì–´ìžˆëŠ” ì˜ì—­ì´ë‹¤. Youngì—ëŠ” Eden, Survivor ì˜ì—­ì´ ìžˆëŠ”ë° Edenì´ ìƒˆë¡œìš´ ê°ì²´ê°€ í• ë‹¹ë˜ëŠ” ì˜ì—­ì´ê³ , Edenì´ ê°€ë“ì°¨ë©´(Minor GC) Survivor ì˜ì—­ìœ¼ë¡œ ì´ë™í•œë‹¤. ì´ë¥¼ ë¬¶ì–´ì„œ Youngì´ë¼ê³  ë¶€ë¥¸ë‹¤.

Old : Survivor ì˜ì—­ê¹Œì§€ ê°€ë“ì°¬ë‹¤ë©´ GCëŠ” Major GCë¥¼ ì‹¤í–‰ì‹œì¼œ ì‚´ì•„ë‚¨ì€ ê°ì²´ë“¤ì„ Old ì˜ì—­ìœ¼ë¡œ ìœ„ì¹˜ì‹œí‚¨ë‹¤. OldëŠ” ì˜¤ëž˜ ì‚´ì•„ë‚¨ì€ ê°ì²´ë“¤ì´ ì €ìž¥ë˜ëŠ” ì˜ì—­ì´ë‹¤.

MetaspaceëŠ” íž™ ì™¸ë¶€ ì˜ì—­ì— ìœ„ì¹˜í•´ ìžˆë‹¤. ì£¼ë¡œ í´ëž˜ìŠ¤ ë©”íƒ€ ì •ë³´ê°€ ì €ìž¥ëœë‹¤.

  - ë‹µë³€ì— ëŒ€í•œ í‰ê°€ : 70ì 
  - í‰ê°€ ì´ìœ  : Young, Old, Metaspaceì— ëŒ€í•œ ê¸°ë³¸ì ì¸ ì„¤ëª…ì„ ìž˜ ì´í•´í•˜ê³  ìžˆëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ Young ì˜ì—­ì˜ Survivor ì˜ì—­ì´ ë‘ ê°œì´ë©°, ë©”ëª¨ë¦¬ íšŒìˆ˜ ê³¼ì •ê³¼ GCê°€ ì´ë“¤ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì— ëŒ€í•´ì„œ ì¶”ê°€ ì„¤ëª…ì´ í•„ìš”í•©ë‹ˆë‹¤.
  - ê²€ìƒ‰ í‚¤ì›Œë“œ : JVM Young Old Metaspace, Java GC Young Old Survivor

ê¼¬ë¦¬ì§ˆë¬¸: Young ì˜ì—­ì˜ Survivor ì˜ì—­ì— ëŒ€í•œ ê°ì²´ ì´ë™ ê³¼ì •ê³¼ GC ìž‘ì—…ì´ ì–´ë–»ê²Œ ì´ë£¨ì–´ì§€ëŠ”ì§€ ìžì„¸ížˆ ì„¤ëª…í•´ì£¼ì„¸ìš”.

Young ì˜ì—­ì—ì„œ Eden ì˜ì—­ì´ ê°€ë“ì°¨ê²Œ ë˜ë©´ Minor GCê°€ ê°ì²´ë¥¼ ìˆ˜ì§‘í•˜ê²Œ ëœë‹¤. ê·¸ ê³¼ì •ì—ì„œ Root Scandì— ë„ë‹¬í•˜ì§€ ëª»í•œ ê°ì²´ëŠ” íšŒìˆ˜ê°€ ë˜ê³ , ê·¸ ì´ì™¸ì— ê°ì²´ë“¤ì€ Survivor 1,2 ì¤‘ í•œê³³ìœ¼ë¡œ ì´ë™í•˜ê²Œ ëœë‹¤. ê·¸ë¦¬ê³  ê·¸ ì´í›„ì— Survivor ì˜ì—­ì„ ë²ˆê°ˆì•„ ì´ë™í•˜ë‹¤ê°€ ì‚´ì•„ë‚¨ì€ ê°ì²´ë“¤ì€ Old ì˜ì—­ìœ¼ë¡œ ì´ë™í•˜ê²Œ ëœë‹¤. í•œ ê°€ì§€ ì£¼ì˜í•  ê²ƒì€ Young GCì˜ ì´ë™ì€ Mark-sweepì´ ì•„ë‹ˆë¼ Copying ë°©ì‹ì´ë‹¤. ë˜í•œ Young GCëŠ” ìˆ˜ì§‘í•˜ê¸° ì „ì— Oldì—ì„œ Youngìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ì°¸ì¡°ë„ ê°™ì´ ë°˜ì˜í•œë‹¤.

ì´ë™ ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

  1. Root ìŠ¤ìº” + Remembered Set ë°˜ì˜
  2. ìƒì¡´ ê°ì²´ ê·¸ëž˜í”„ íŠ¸ë ˆì´ì‹±(ë„ë‹¬ ê°€ëŠ¥ íŒë³„)
  3. ë³µì‚¬ + í¬ì›Œë”© í¬ì¸í„° ì„¤ì •
    - í¬ì›Œë”© í¬ì¸í„° : ê°ì²´ê°€ ì´ë™í•œ ê³³ í‘œì‹œ
  4. ì°¸ì¡° ì—…ë°ì´íŠ¸(í¬ì¸í„° ìˆ˜ì •)
    - ì˜®ê²¨ì§„ ìƒˆ ì£¼ì†Œë¡œ ëª¨ë“  ì°¸ì¡°ë¥¼ ë°”ê¿ˆ

>
>
> - ë‹µë³€ì— ëŒ€í•œ í‰ê°€ : 90ì 
> - í‰ê°€ ì´ìœ  : Young ì˜ì—­ì˜ ê°ì²´ ì´ë™ ë° GC ê³¼ì •ì— ëŒ€í•´ ìžì„¸ížˆ ì„¤ëª…í•´ì£¼ì…¨ê³ , Mark-sweepì´ ì•„ë‹ˆë¼ Copying ë°©ì‹ìœ¼ë¡œ ì´ë£¨ì–´ì§„ë‹¤ëŠ” ì ë„ ë‚´ìš©ì— í¬í•¨ë˜ì–´ ìžˆìŠµë‹ˆë‹¤. ë˜í•œ Young GCì—ì„œ Old ì˜ì—­ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ì°¸ì¡°ë„ ë°˜ì˜ëœë‹¤ëŠ” ì ì„ ì„¤ëª…í•´ì£¼ì…¨ìŠµë‹ˆë‹¤.
> - ê²€ìƒ‰ í‚¤ì›Œë“œ : JVM Young GC process, Java Copying Garbage Collection

ê¼¬ë¦¬ì§ˆë¬¸: Old ì˜ì—­ì—ì„œì˜ ê°ì²´ ìˆ˜ì§‘ê³¼ì •ê³¼ GC ì•Œê³ ë¦¬ì¦˜ì—ëŠ” ì–´ë–¤ ì°¨ì´ê°€ ìžˆë‚˜ìš”?

Old ì˜ì—­ì—ì„œì˜ ê°ì²´ ìˆ˜ì§‘ê³¼ì •ì„ ë³´ë©´ Full GCê°€ ì˜¤ëž˜ê±¸ë¦¬ëŠ” ì´ìœ ë¥¼ ì•Œ ìˆ˜ ìžˆë‹¤. Youngì€ Edenì„ í†µì§¸ë¡œ ë¹„ìš°ëŠ” ê·¸ë¦¼ì´ì§€ë§Œ OldëŠ” ì‚´ì•„ìžˆëŠ” ê°ì²´ê°€ ë§Žê³  í©ì–´ì ¸ ìžˆê¸° ë•Œë¬¸ì— ê³¼ì •ì´ ë” ë¬´ê²ë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— íšŒìˆ˜, ì´ë™ ê³¼ì • ì´ì™¸ì—ë„ ì••ì¶• ë˜ëŠ” ìž¬ë°°ì¹˜ ê³¼ì •ì´ ì´ë£¨ì–´ì ¸ì•¼ í•œë‹¤.
Old GCëŠ” í¬ê²Œ 4ë‹¨ê³„ë¡œ ì´ë£¨ì–´ì ¸ ìžˆë‹¤.

  1. Mark (í‘œì‹œ)
  2. Reclaim (íšŒìˆ˜)
  3. Compact ë˜ëŠ” Evacuate (ì••ì¶• ë˜ëŠ” ì´ë™)
  4. Reference Update (ì°¸ì¡° ìˆ˜ì •)

GC ì•Œê³ ë¦¬ì¦˜ì´ ì°¨ì´ëŠ” ë‘ ê°€ì§€ë¡œ ë³¼ ìˆ˜ ìžˆë‹¤.

  1. STWë¡œ í•œ ë²ˆì— ì •ë¦¬í•˜ê±°ë‚˜ ë™ì‹œì— ì •ë¦¬
  2. ë‹¨íŽ¸í™”ë¥¼ Sweepìœ¼ë¡œ ë‘ê±°ë‚˜ ì´ë™/ì••ì¶•ìœ¼ë¡œ í•´ê²°

>
>
> - ë‹µë³€ì— ëŒ€í•œ í‰ê°€ : 95ì 
> - í‰ê°€ ì´ìœ  : Old ì˜ì—­ì—ì„œì˜ ê°ì²´ ìˆ˜ì§‘ê³¼ì • ë° GC ì•Œê³ ë¦¬ì¦˜ ë‹¨ê³„ì— ëŒ€í•´ ìžì„¸ížˆ ì„¤ëª…í•´ ì£¼ì…¨ìŠµë‹ˆë‹¤. ë˜í•œ Full GCê°€ ì˜¤ëž˜ ê±¸ë¦¬ëŠ” ì´ìœ ì™€ Old ì˜ì—­ì—ì„œì˜ ì••ì¶• ë˜ëŠ” ìž¬ë°°ì¹˜ ê³¼ì •ì´ í•„ìš”í•œ ì´ìœ ì— ëŒ€í•´ë„ ì„¤ëª…í•´ì£¼ì…¨ìŠµë‹ˆë‹¤. ë”ë¶ˆì–´ GC ì•Œê³ ë¦¬ì¦˜ì˜ ì°¨ì´ì— ëŒ€í•œ ì„¤ëª…ë„ í¬í•¨ë˜ì–´ ì´í•´ê°€ ìž˜ ë˜ì—ˆìŠµë‹ˆë‹¤.
> - ê²€ìƒ‰ í‚¤ì›Œë“œ : Java Old GC process, Garbage Collection compaction vs fragmentation
>
> ê¼¬ë¦¬ì§ˆë¬¸: Old ì˜ì—­ì—ì„œì˜ ì••ì¶•ê³¼ ì´ë™/ìž¬ë°°ì¹˜ ê³¼ì •ì€ ê°ê° ì–´ë–¤ ìƒí™©ì—ì„œ ì–´ë–»ê²Œ ì„ íƒë˜ëŠ”ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”.
>

Oldì— ë‹¨íŽ¸í™”ê°€ ì‹¬í•œê°€, GCê°€ Region ê¸°ë°˜ì¸ê°€ ì—°ì† ì„¸ëŒ€ ê¸°ë°˜ì¸ê°€, ì§€ì—°ì‹œê°„ì´ ì—„ê²©í•œê°€, ì‚´ì•„ìžˆëŠ” ê°ì²´ ë¹„ìœ¨ì´ ë†’ì€ê°€ì˜ ê¸°ì¤€ìœ¼ë¡œ íŒë‹¨í•  ìˆ˜ ìžˆë‹¤.

ë‹¨íŽ¸í™”ê°€ ì‹¬í•˜ê²Œ ë˜ë©´ ë‹¨íŽ¸í™” ì œê±°ê°€ ì‹œê¸‰í•˜ê¸° ë•Œë¬¸ì— ì••ì¶© ë˜ëŠ” ì´ë™ì´ í•„ìš”í•˜ë‹¤.

Region ê¸°ë°˜ì´ë©´ ê¸°ë³¸ì´ ì´ë™/ìž¬ë°°ì¹˜ì´ê³  ì—°ì† ì„¸ëŒ€ ê¸°ë°˜ì´ë©´ ê¸°ë³¸ì´ ì••ì¶•ì´ë‹¤.

ì§€ì—°ì‹œê°„ì´ ì—„ê²©í•˜ë©´ íšŒìˆ˜ ë™ì‹œì— ì´ë™/ìž¬ë°°ì¹˜ê°€ ì´ë£¨ì–´ì§„ë‹¤.

ì§€ì—°ì‹œê°„ì´ ì—„ê²©í•˜ì§€ ì•Šìœ¼ë©´ STW ì••ì¶•ë„ ê°ìˆ˜í•´ì„œ í•œë²ˆì— í•´ê²°í•œë‹¤.

ê°€ë¹„ì§€ ì˜ì—­ì´ ë§Žìœ¼ë©´ ì´ë™/ìž¬ë°°ì¹˜ê°€ íš¨ìœ¨ì ì´ê³ , ëŒ€ë¶€ë¶„ ì‚´ì•„ìžˆê³  í©ì–´ì ¸ ìžˆìœ¼ë©´ ì••ì¶•ì´ íš¨ìœ¨ì ì´ë‹¤.

>
>
> - ë‹µë³€ì— ëŒ€í•œ í‰ê°€ : 100ì 
> - í‰ê°€ ì´ìœ  : Old ì˜ì—­ì—ì„œì˜ ì••ì¶•ê³¼ ì´ë™/ìž¬ë°°ì¹˜ ê³¼ì •ì´ ì„ íƒë˜ëŠ” ê¸°ì¤€ì— ëŒ€í•´ ìžì„¸í•˜ê³  ëª…í™•í•˜ê²Œ ì„¤ëª…í•´ì£¼ì…¨ìŠµë‹ˆë‹¤. ê°ê°ì˜ ê²½ìš°ì— ë”°ë¼ ì–´ë–¤ ë°©ë²•ì´ ì í•©í•œì§€ ìž˜ êµ¬ë¶„í•˜ì—¬ ì„¤ëª…í•˜ì…¨ìŠµë‹ˆë‹¤.
> - ê²€ìƒ‰ í‚¤ì›Œë“œ : Garbage Collection defragmentation criteria, Java GC region-based vs generational-based
>
> í•™ìŠµë‚´ìš©ì— ëŒ€í•´ ê¹Šê²Œ ì´í•´í•˜ê³  ìžˆëŠ” ëª¨ìŠµì´ë©°, ë” ê¹Šì€ ìˆ˜ì¤€ì˜ ê³µë¶€ì™€ íƒêµ¬ë¥¼ í•  ê²ƒì„ ê¶Œìž¥ë“œë¦½ë‹ˆë‹¤. êµ‰ìž¥ížˆ í›Œë¥­í•œ ë‹µë³€ì´ì—ˆìŠµë‹ˆë‹¤. ì¶”ê°€ì ì¸ ê¶ê¸ˆí•œ ì‚¬í•­ì´ ìžˆê±°ë‚˜ ë” íƒêµ¬í•´ë³¼ ì£¼ì œê°€ ìžˆìœ¼ë©´ ì•Œë ¤ì£¼ì„¸ìš”.
>

## ì¶œì²˜

---

https://docs.oracle.com/javase/specs/jvms/se25/html/jvms-2.html#jvms-2.5

https://junhyunny.github.io/information/java/what-is-jvm/

https://mangkyu.tistory.com/301

https://d2.naver.com/helloworld/1230

ì±… - JVM Intern íŒŒí—¤ì¹˜ê¸°